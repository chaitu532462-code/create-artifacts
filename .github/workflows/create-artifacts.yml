name: list-files

on:
  push:
  workflow_dispatch:

jobs:
  files_data:
    name: List files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Check Python
        run: python --version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install azure-ai-inference

      - name: Run inference script
        env:
          AZURE_INFERENCE_TOKEN: ${{ secrets.AZURE_INFERENCE_TOKEN }}
        run: |
          # Fail if the secret is not provided
          if [ -z "${AZURE_INFERENCE_TOKEN}" ]; then
            echo "ERROR: AZURE_INFERENCE_TOKEN is not set. Set the secret in the repository settings."
            exit 1
          fi

          # Replace `inference.py` with your actual script filename if different
          if [ -f run_llm.py ]; then
            echo "Running run_llm.py"
            python run_llm.py
          else
            echo "ERROR: run_llm.py not found. Add the script or update the workflow to the correct filename."
            exit 1
          fi