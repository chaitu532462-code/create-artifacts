name: list-files

on:
  workflow_dispatch:

jobs:
  files_data:
    name: List files
    runs-on: ubuntu-latest
    env:
      AZURE_INFERENCE_TOKEN: ${{ secrets.AZURE_INFERENCE_TOKEN }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Check Python
        run: python --version

      - name: List repository files
        run: |
          echo "Repository files (top-level):"
          ls -la
          echo
          echo "Repository files (recursive) -> files-list.txt"
          ls -R > files-list.txt
          echo "files-list.txt contents:"
          cat files-list.txt

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install azure-ai-inference

      - name: Run inference script
        run: |
          # Fail early if the secret is missing
          if [ -z "${AZURE_INFERENCE_TOKEN}" ]; then
            echo "ERROR: AZURE_INFERENCE_TOKEN is not set. Set the secret in repository settings."
            exit 1
          fi

          # Prefer run_llm.py, fall back to inference.py
          if [ -f run_llm.py ]; then
            echo "Running run_llm.py"
            python run_llm.py
          
          else
            echo "ERROR: No inference script found (run_llm.py or inference.py)."
            exit 1
          fi

      